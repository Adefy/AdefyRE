<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>AdefyWebGL Test</title>

  <script type="text/javascript" src="./underscore.min.js"></script>
  <script type="text/javascript" src="./cp.min.js"></script>
  <script type="text/javascript" src="./sylvester.js"></script>
  <script type="text/javascript" src="./glUtils.js"></script>
  <script type="text/javascript" src="./are.js"></script>

  <style>
  * {
    padding: 0;
    margin: 0;
  }
  div#SceneInfo span{
    padding: 4px;
  }
  </style>
</head>

<body>
  <div id="SceneInfo" style="background-color: #33b5e5">
    <span id="RendererMode"></span>
    <span id="ActorCount"></span>
  </div>
  <script>

    var manifest = {
      "textures": [{
        "type": "image",
        "name": "metalGrate",
        "path": "metalGrate.jpg"
      },{
        "type": "image",
        "name": "roundThing",
        "path": "roundThing.jpg"
      }]
    };

    var width = window.innerWidth;
    var height = window.innerHeight;

    ARERenderer.rendererMode = 0

    window.engine = window.AdefyGLI.Engine().initialize(width, height, function() {
      window.AdefyGLI.Engine().loadManifest(JSON.stringify(manifest), function() {

        window.engine.setClearColor(255, 255, 255);

        var ground = new ARERectangleActor(width, height * 0.05);
        ground.setPosition({ x: width / 2, y: height * 0.025 })
        .setTexture("metalGrate")
        .setTextureRepeat(20, 0.5)
        .createPhysicsBody(0, 0.7, 0.6);

        new ARECircleActor(128)
        .setPosition({ x: width / 2, y: height / 2 })
        .setTexture("roundThing")
        .createPhysicsBody(100, 0.8, 0.7);

        var createBall = function() {
          var x = Math.random() * width;
          var y = (Math.random() * 500) + height;

          var mass = Math.random() * 100;
          var friction = Math.random();
          var elasticity = Math.random() * 1.2;

          var ball = new ARECircleActor(Math.round(Math.random() * 32) + 5)
          .setPosition({ x: x, y: y })
          .setTexture("roundThing")
          .createPhysicsBody(mass, friction, elasticity);
        };

        var scheduleBallTimeout = function() {
          setTimeout(function() {
            createBall();
            document.getElementById("ActorCount").innerHTML = "Actor Count: " + String(ARERenderer.actors.length);
            scheduleBallTimeout();
          }, Math.random() * 500);
        };

        // Throw out the old balls ~_~
        // For people like IceDragon, who has a shitty computer
        var ballGCTimeout = function() {
          setTimeout(function() {
            var to_remove = [];
            for (var i = 0; i < ARERenderer.actors.length; i++) {
              actor = ARERenderer.actors[i];
              if (actor.getPosition().y < -height)
                to_remove.push(actor);
            };
            for (var i = 0; i < to_remove.length; i++) {
              ARERenderer.removeActor(to_remove[i]);
            };
            ballGCTimeout();
          }, 5000);
        };

        scheduleBallTimeout();
        ballGCTimeout();

        document.getElementById("RendererMode").innerHTML = "Renderer Mode: " + String(ARERenderer.rendererMode);

      });
    });

  </script>
</body>
</html>
