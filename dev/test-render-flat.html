<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>AdefyWebGL Rendering Test</title>

  <script type="text/javascript" src="./js/underscore.min.js"></script>
  <script type="text/javascript" src="./js/cp.min.js"></script>
  <!-- <script type="text/javascript" src="./js/sylvester.js"></script> -->
  <script type="text/javascript" src="./js/EWGL_math.js"></script>
  <!-- <script type="text/javascript" src="./js/glUtils.js"></script> -->
  <script type="text/javascript" src="./js/inkyEWGL.js"></script>
  <script type="text/javascript" src="./js/are.js"></script>

  <link type="text/css" rel="stylesheet" href="./css/main.css"/>
</head>

<body>
  <div id="SceneInfo" style="background-color: #33b5e5">
    <span id="RendererMode"></span>
    <span id="ActorCount"></span>
  </div>
  <script>

    rand = function(n) {
      return Math.floor(Math.random() * n);
    };

    onManifestLoad = function() {
      // FINALLY WE CAN START!
      // So after the manifests have loaded, we can finally get started (I hope)
      // Don't ask, too lazy to convert these values to ints...
      // Proves that setClearColor works
      window.AdefyRE.Engine().setClearColor(0x0, 0x0, 0x0);
      var engineWidth = window.AdefyRE.Engine().getWidth();
      var engineHeight = window.AdefyRE.Engine().getHeight();
      var w = 96;
      var h = 96;
      var cols = Math.floor(engineWidth / w);
      var rows = Math.floor(engineHeight / h);
      var totalblocks = Math.floor(cols * rows);
      for (var i = 0; i < totalblocks; i++) {
        new ARERectangleActor(w, h)
        // Little fact: The scene is upside down.
        .setPosition({ x: 48 + w * Math.floor(i % cols),
                       y: engineHeight - 48 - h * Math.floor(i / cols) })
        .setColor(rand(256), rand(256), rand(256));
      }
    };

    onEngineInit = function() {
      // So lets load some blocks into the Texture cache
      var manifest = {
      };

      window.AdefyRE.Engine().loadManifest(JSON.stringify(manifest), function() {
        onManifestLoad(); // Callback #2
      })
    };

    // First order of business, CHOOSE YOUR DESTINY
    // Actually just choose a renderer mode, you can choose from
    // the NULL renderer, the WGL renderer, or the CANVAS renderer; modes
    //ARERenderer.rendererMode = ARERenderer.RENDERER_MODE_NULL
    //ARERenderer.rendererMode = ARERenderer.RENDERER_MODE_CANVAS
    ARERenderer.rendererMode = ARERenderer.RENDERER_MODE_WGL

    var width = window.innerWidth;
    var height = window.innerHeight;
    window.engine = window.AdefyRE.Engine().initialize(width, height, function() {
      onEngineInit(); // Callback #1
    });

    // Man this gets ugly fast...

    var modestr = "N/A";
    if (ARERenderer.activeRendererMode === ARERenderer.RENDERER_MODE_WGL)
      modestr = "WebGL"
    else if (ARERenderer.activeRendererMode === ARERenderer.RENDERER_MODE_CANVAS)
      modestr = "Canvas"

    document.getElementById("RendererMode").innerHTML = "Renderer Mode: " + modestr;

  </script>
</body>
</html>